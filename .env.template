# Copy this file to `.env` and fill values. Never commit `.env` (it is gitignored).

# Required
METACULUS_TOKEN=YOUR_METACULUS_TOKEN

# Optional: second Metaculus token for tracking another account in digest mode
METACULUS_TRACK_TOKEN=YOUR_METACULUS_TRACK_TOKEN

# Optional: Digest comparison mode ("account" or "state")
DIGEST_COMPARE_MODE=account

# Optional: Limit questions per tournament for digest runs (useful for cheaper tests)
DIGEST_MAX_QUESTIONS_PER_TOURNAMENT=10

# Optional (pick what you actually use)
OPENROUTER_API_KEY=YOUR_OPENROUTER_API_KEY
PERPLEXITY_API_KEY=YOUR_PERPLEXITY_API_KEY
OPENAI_API_KEY=YOUR_OPENAI_API_KEY
EXA_API_KEY=YOUR_EXA_API_KEY
# Note: If EXA_API_KEY is set and BOT_ENABLE_WEB_SEARCH=true, the template defaults to Exa via SmartSearcher
# (instead of using BOT_SEARCH_MODEL's *-search-preview browsing model). To force the browsing model, run
# `python main.py --researcher <model>` or unset EXA_API_KEY.
ASKNEWS_CLIENT_ID=YOUR_ASKNEWS_CLIENT_ID
ASKNEWS_SECRET=YOUR_ASKNEWS_SECRET
ANTHROPIC_API_KEY=YOUR_ANTHROPIC_API_KEY

# Optional: SEC EDGAR endpoints require a descriptive User-Agent (policy / rate limiting).
# Examples:
# - "my-metac-bot (you@example.com)"
# - "metaculus-bot revenue-prefetch (contact: you@example.com)"
# If SEC_USER_AGENT is not set, the bot will derive a reasonable User-Agent from repo metadata and (optionally)
# SEC_CONTACT_EMAIL. It will NOT use your local git-config email unless you explicitly opt in.
# Optional: set SEC_CONTACT_EMAIL to provide contact info without writing a full UA string.
SEC_USER_AGENT=YOUR_SEC_USER_AGENT
SEC_CONTACT_EMAIL=
BOT_ALLOW_GIT_EMAIL_FOR_SEC_USER_AGENT=false

# Optional: Nasdaq API user agent (defaults to a browser-like UA; some endpoints block bot-looking UAs)
# Example: "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/121.0.0.0 Safari/537.36"
NASDAQ_USER_AGENT=

# Optional: Use KIconnect as your non-search LLM (OpenAI-compatible proxy)
KICONNECT_API_URL=YOUR_KICONNECT_API_URL   # e.g. https://.../api/v1
KICONNECT_API_KEY=YOUR_KICONNECT_API_KEY   # format is typically "keyId:secret"
KICONNECT_MODEL=YOUR_KICONNECT_MODEL       # deployment/model name configured in KIconnect
KICONNECT_MODEL_FALLBACKS=                 # optional comma-separated, e.g. gpt-4.1,gpt-4o-mini,gpt-oss-120b

# Optional: LLM max_tokens (helps avoid OpenRouter low-credit errors)
BOT_MAX_TOKENS=4096

# Optional: model split (minimize web-search cost)
# - Forecasting/parsing uses BOT_BASE_MODEL (many calls).
# - Research uses BOT_SEARCH_MODEL (ideally 1 call per question).
# Cost-optimized setup:
#   - Use free reasoning model (gpt-oss-120b:free) for forecasting/parsing
#   - Use search model only for research (gpt-4o-mini-search-preview)
BOT_BASE_MODEL=openrouter/openai/gpt-oss-120b:free
BOT_SEARCH_MODEL=openrouter/openai/gpt-4o-mini-search-preview
BOT_ENABLE_WEB_SEARCH=true
# Optional: Tool-router (adds 1 extra cheap LLM call per question) that decides which sources to use:
# - Local crawl (if enabled) and official sources first
# - Web search (SmartSearcher/Exa or browsing models) only if needed
BOT_ENABLE_TOOL_ROUTER=true
# Optional: Token budget control for the router prompt (truncate local crawl before routing).
BOT_TOOL_ROUTER_LOCAL_CONTEXT_MAX_CHARS=6000
# Optional: For EPS-style questions, try free Nasdaq endpoints first and skip Exa/search if successful.
BOT_ENABLE_FREE_EPS_PREFETCH=true
# Optional: For revenue-style questions, try free SEC companyfacts + community anchor first and skip Exa/search if successful.
BOT_ENABLE_FREE_REVENUE_PREFETCH=true
# Optional: Add free SEC filings links (10-K/10-Q/8-K) as extra research context when a ticker can be inferred.
BOT_ENABLE_FREE_SEC_FILINGS_PREFETCH=true
BOT_SEC_FILINGS_MAX_ITEMS=6
# BOT_SINGLE_MODEL=openrouter/openai/gpt-4o-mini  # override everything with one model (debug/experiments)

# Optional: retries/timeouts (recommended for free models)
# Note: forecasting-tools retries can back off up to 60s between attempts; keeping base allowed tries low avoids long waits.
BOT_BASE_TIMEOUT_SECONDS=30
BOT_BASE_ALLOWED_TRIES=1

# Optional: Enable OpenRouter reasoning (auto-enabled for gpt-oss models)
BOT_ENABLE_REASONING=true

# Calibration / risk controls are handled automatically in code (no env settings).

# Optional: Fallback model when free model hits rate limit
# If not set, auto-detects by removing ":free" suffix from BOT_BASE_MODEL
BOT_ENABLE_FALLBACK=true
BOT_FALLBACK_MODEL=openrouter/openai/gpt-oss-120b:free
BOT_FALLBACK_TIMEOUT_SECONDS=120
BOT_FALLBACK_ALLOWED_TRIES=2

# Optional: Safety guardrail - require KICONNECT_* env vars when using this template
# (prevents accidentally falling back to paid OpenAI models if OPENAI_API_KEY is set)
BOT_REQUIRE_KICONNECT=false

# Optional: Concurrency control (avoid rate limits on free models)
# Set to 1 to process questions sequentially (recommended for free models)
BOT_MAX_CONCURRENT_QUESTIONS=1
BOT_MAX_CONCURRENT_TASKS=1

# Optional: tournament_update refresh heuristics
# If enabled, the bot will re-forecast (daily refresh) when its last forecast is far from community consensus,
# even if the community forecast itself hasn't moved much.
BOT_TOURNAMENT_UPDATE_FORCE_ALL_OPEN=false
BOT_ENABLE_UPDATE_ON_CP_DIVERGENCE=true
BOT_UPDATE_ON_CP_DIVERGENCE_MIN_HOURS_SINCE_LAST_FORECAST=12
BOT_UPDATE_ON_CP_DIVERGENCE_BINARY_ABS_DELTA=0.20
BOT_UPDATE_ON_CP_DIVERGENCE_MC_TVD=0.25
BOT_UPDATE_ON_CP_DIVERGENCE_NUM_NORM_MEDIAN_SHIFT=0.60
BOT_UPDATE_ON_CP_DIVERGENCE_DATE_ABS_DAYS=60

# Optional: Tournament slugs/URLs (override workflow defaults without code changes)
METACULUS_CUP_TOURNAMENT=https://www.metaculus.com/tournament/metaculus-cup-spring-2026/
AIB_TOURNAMENT=https://www.metaculus.com/tournament/spring-aib-2026/
MARKET_PULSE_TOURNAMENT=https://www.metaculus.com/tournament/market-pulse-26q1/

# Optional: Matrix notifications (digest mode)
MATRIX_HOMESERVER=https://matrix.example.com
MATRIX_ACCESS_TOKEN=YOUR_MATRIX_BOT_ACCESS_TOKEN
MATRIX_ROOM_ID=!yourRoomId:example.com

# Optional: SmartSearcher tuning (when using --researcher smart-searcher/...)
SMART_SEARCHER_NUM_SEARCHES=1
SMART_SEARCHER_NUM_SITES_PER_SEARCH=5
SMART_SEARCHER_USE_ADVANCED_FILTERS=false

# Optional: Local question-link crawl (Playwright/Chromium)
# Fetches the Metaculus question page (optional) + all explicit links in the question text fields,
# renders them locally (supports JS-heavy pages), extracts main content, and feeds that text into the research prompt.
#
# Requires installing optional deps + browser runtime:
# - `poetry install --with web`
# - `poetry run playwright install chromium`
BOT_ENABLE_LOCAL_QUESTION_CRAWL=false
BOT_LOCAL_CRAWL_INCLUDE_QUESTION_PAGE=true
BOT_LOCAL_CRAWL_MAX_URLS=8
BOT_LOCAL_CRAWL_MAX_CONCURRENCY=2
BOT_LOCAL_CRAWL_NAV_TIMEOUT_SECONDS=30
BOT_LOCAL_CRAWL_NETWORK_IDLE_TIMEOUT_SECONDS=5
BOT_LOCAL_CRAWL_TOTAL_CHAR_BUDGET=20000
BOT_LOCAL_CRAWL_PER_URL_CHAR_BUDGET=4000
BOT_LOCAL_CRAWL_BLOCKED_RESOURCE_TYPES=image,font,media
BOT_LOCAL_CRAWL_USER_AGENT=
# Security/safety defaults (recommended):
# - Disallow crawling private/loopback/link-local hosts (SSRF protection)
# - Enforce TLS validation (do not ignore HTTPS errors)
BOT_LOCAL_CRAWL_ALLOW_PRIVATE_HOSTS=false
BOT_LOCAL_CRAWL_IGNORE_HTTPS_ERRORS=false
BOT_LOCAL_CRAWL_RESOLVE_DNS=true

# Optional: Retrospective report (resolved questions you forecasted)
# Used by: `python main.py --mode retrospective`
BOT_RETROSPECTIVE_MAX_QUESTIONS=100
BOT_RETROSPECTIVE_HTTP_TIMEOUT_SECONDS=30
BOT_RETROSPECTIVE_API2_MAX_RETRIES=4
BOT_RETROSPECTIVE_API2_MIN_DELAY_SECONDS=0.2
BOT_RETROSPECTIVE_API2_BACKOFF_BASE_SECONDS=1.0
